<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro-Structure X-Ray</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="/lib/lightweight-charts.standalone.production.js"></script>
</head>

<body>
    <div class="app">

        <!-- ═══════════════ SIDEBAR ═══════════════ -->
        <aside class="sidebar">
            <div class="brand">
                <h1>Micro-Structure X-Ray</h1>
                <span id="symbolBadge" class="badge">CONNECTING...</span>
            </div>

            <div class="sidebar-section">
                <label>Market</label>
                <div id="currentPrice" class="price mono">--.--</div>
                <div id="tickCounter" class="muted small">0 ticks</div>
                <div id="warmupBadge" class="warmup-pill">WARMING UP</div>
            </div>

            <div class="sidebar-section">
                <label>Parameters</label>
                <div class="toggle-group">
                    <button class="toggle-btn active" id="btnUp">Touch ▲</button>
                    <button class="toggle-btn" id="btnDown">Touch ▼</button>
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <span>Barrier</span>
                        <input type="number" id="barrierInput" value="2.0" step="0.01" class="mono">
                    </div>
                    <div class="input-group">
                        <span>ROI %</span>
                        <input type="number" id="roiInput" value="109" step="1" class="mono">
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <label>Probability Analysis</label>
                <div class="data-row"><span>Theoretical (GBM)</span><span id="theoProb" class="mono">--%</span></div>
                <div class="data-row"><span>Empirical (Data)</span><span id="empProb" class="mono">--%</span></div>
                <div class="data-row divider"><span>Model Estimate</span><span id="ourProb" class="mono bold">--%</span>
                </div>
                <div class="data-row"><span>Breakeven</span><span id="derivProb" class="mono">--%</span></div>
                <div class="data-row"><span>Sample Size</span><span id="sampleSize" class="mono">--</span></div>
            </div>

            <div class="sidebar-section">
                <label>Difference (Model − Breakeven)</label>
                <div id="edgeNumber" class="edge-number mono">--%</div>
            </div>

            <div class="sidebar-section">
                <label>Context</label>
                <div id="warningsList" class="warnings-list"></div>
            </div>

            <div class="sidebar-section">
                <label>Volatility (Log-Return σ)</label>
                <div class="vol-bars">
                    <div class="vol-row"><span>10s</span>
                        <div class="bar-track">
                            <div id="bar10" class="bar-fill"></div>
                        </div>
                    </div>
                    <div class="vol-row"><span>30s</span>
                        <div class="bar-track">
                            <div id="bar30" class="bar-fill"></div>
                        </div>
                    </div>
                    <div class="vol-row"><span>60s</span>
                        <div class="bar-track">
                            <div id="bar60" class="bar-fill"></div>
                        </div>
                    </div>
                </div>
                <div class="data-row mt-sm"><span>Vol Ratio</span><span id="volRatio" class="mono">--</span></div>
                <div class="data-row"><span>State</span><span id="volTrend" class="mono">--</span></div>
                <div class="data-row"><span>Momentum</span><span id="momentum" class="mono">--</span></div>
            </div>
        </aside>

        <!-- ═══════════════ CHART AREA ═══════════════ -->
        <main class="chart-area">

            <!-- Tab Bar -->
            <div class="tab-bar">
                <button class="tab active" data-view="tickView">Tick</button>
                <button class="tab" data-view="view5s">5s</button>
                <button class="tab" data-view="view10s">10s</button>
                <button class="tab" data-view="view15s">15s</button>
                <button class="tab" data-view="view30s">30s</button>
                <button class="tab" data-view="view1m">1m</button>
                <button class="tab" data-view="view5m">5m</button>
                <button class="tab" data-view="viewGrid">Grid</button>
            </div>

            <!-- Drawing Toolbar -->
            <div class="drawing-toolbar" id="drawingToolbar">
                <span class="toolbar-label">Draw:</span>
                <button class="tool-btn active" data-tool="none" title="Pointer (no drawing)">↖</button>
                <button class="tool-btn" data-tool="hline" title="Horizontal Line">H</button>
                <button class="tool-btn" data-tool="vline" title="Vertical Line">V</button>
                <button class="tool-btn" data-tool="ray" title="Ray (half-trendline)">→</button>
                <button class="tool-btn" data-tool="trendline" title="Trendline">/</button>
                <button class="tool-btn" data-tool="rectangle" title="Rectangle">▭</button>
                <button class="tool-btn" data-tool="triangle" title="Triangle">△</button>
                <button class="tool-btn" data-tool="fib" title="Fibonacci Retracement">Fib</button>
                <button class="tool-btn" data-tool="text" title="Text / Comment">T</button>
                <div class="toolbar-sep"></div>
                <label class="color-label" title="Drawing color">
                    <input type="color" id="drawingColor" value="#f59e0b">
                </label>
                <button class="tool-btn del-btn" id="btnDeleteDrawing" title="Delete selected drawing">✕</button>
            </div>

            <!-- Chart Views -->
            <div id="tickView" class="chart-view active">
                <div id="tickChart" class="chart-container"></div>
            </div>
            <div id="view5s" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 5s candle</div>
                    <div class="cd-fill" id="cd5s"></div>
                    <div class="cd-time" id="cdt5s">5.0s</div>
                </div>
                <div id="chart5s" class="chart-container"></div>
            </div>
            <div id="view10s" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 10s candle</div>
                    <div class="cd-fill" id="cd10s"></div>
                    <div class="cd-time" id="cdt10s">10.0s</div>
                </div>
                <div id="chart10s" class="chart-container"></div>
            </div>
            <div id="view15s" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 15s candle</div>
                    <div class="cd-fill" id="cd15s"></div>
                    <div class="cd-time" id="cdt15s">15.0s</div>
                </div>
                <div id="chart15s" class="chart-container"></div>
            </div>
            <div id="view30s" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 30s candle</div>
                    <div class="cd-fill" id="cd30s"></div>
                    <div class="cd-time" id="cdt30s">30.0s</div>
                </div>
                <div id="chart30s" class="chart-container"></div>
            </div>
            <div id="view1m" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 1m candle</div>
                    <div class="cd-fill" id="cd1m"></div>
                    <div class="cd-time" id="cdt1m">60.0s</div>
                </div>
                <div id="chart1m" class="chart-container"></div>
            </div>
            <div id="view5m" class="chart-view">
                <div class="countdown-bar">
                    <div class="cd-label">Next 5m candle</div>
                    <div class="cd-fill" id="cd5m"></div>
                    <div class="cd-time" id="cdt5m">300s</div>
                </div>
                <div id="chart5m" class="chart-container"></div>
            </div>

            <!-- Flexible Grid View -->
            <div id="viewGrid" class="chart-view grid-view">
                <div class="grid-cell">
                    <div class="grid-header">
                        <select class="tf-select" id="gridLeftTf">
                            <option value="5s" selected>5 Seconds</option>
                            <option value="10s">10 Seconds</option>
                            <option value="15s">15 Seconds</option>
                            <option value="30s">30 Seconds</option>
                            <option value="1m">1 Minute</option>
                            <option value="2m">2 Minutes</option>
                            <option value="5m">5 Minutes</option>
                        </select>
                        <span class="cd-inline" id="cdGridLeft">--</span>
                    </div>
                    <div id="gridChartLeft" class="chart-container"></div>
                </div>
                <div class="grid-cell">
                    <div class="grid-header">
                        <select class="tf-select" id="gridRightTf">
                            <option value="5s">5 Seconds</option>
                            <option value="10s">10 Seconds</option>
                            <option value="15s" selected>15 Seconds</option>
                            <option value="30s">30 Seconds</option>
                            <option value="1m">1 Minute</option>
                            <option value="2m">2 Minutes</option>
                            <option value="5m">5 Minutes</option>
                        </select>
                        <span class="cd-inline" id="cdGridRight">--</span>
                    </div>
                    <div id="gridChartRight" class="chart-container"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Text input overlay for comment tool -->
    <div id="textInputOverlay" class="text-input-overlay" style="display:none">
        <input type="text" id="textInputField" placeholder="Type comment, Enter to place">
    </div>

    <script src="app.js"></script>
</body>

</html>